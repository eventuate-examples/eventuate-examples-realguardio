=== User Story: Arm Security System

[source,gherkin]
----
Feature: Arm Security System
  As an authorized employee
  I want to arm a security system at a location
  So that the location is protected

  Scenario: Successfully arm security system with proper authorization
    Given I am authenticated as employee with ID 456
    And a security system exists with ID 789 at location 123
    And I have role "SECURITY_SYSTEM_ARMER" at location 123
    And the security system is currently disarmed
    When I submit a request to arm security system 789
    Then the Security System Service validates my JWT token
    And the service retrieves the security system and associated location
    And the service queries Oso Cloud: "Can employee 456 'arm' security system 789?"
    And Oso Cloud evaluates the policy and returns "allowed: true"
    And the security system armed status is updated to true
    And I receive a 200 OK response
    And a SecuritySystemArmed event is published to Kafka
    And the Oso Integration Service processes the event for audit logging

  Scenario: Attempt to arm security system without proper authorization
    Given I am authenticated as employee with ID 456
    And a security system exists with ID 789 at location 123
    And I do not have role "SECURITY_SYSTEM_ARMER" at location 123
    When I submit a request to arm security system 789
    Then the Security System Service queries Oso Cloud
    And Oso Cloud evaluates the policy and returns "allowed: false"
    And I receive a 403 Forbidden response
    And the error message indicates "Insufficient permissions to arm this security system"
    And the security system remains in its current state
    And no event is published

  Scenario: Attempt to arm non-existent security system
    Given I am authenticated as employee with ID 456
    When I submit a request to arm security system 999
    Then I receive a 404 Not Found response
    And the error message indicates "Security system not found"

  Scenario: Arm security system when Oso Cloud is unavailable
    Given I am authenticated as employee with ID 456
    And a security system exists with ID 789 at location 123
    And I have role "SECURITY_SYSTEM_ARMER" at location 123
    When I submit a request to arm security system 789
    And Oso Cloud is unreachable
    Then I receive a 503 Service Unavailable response
    And the error message indicates "Authorization service unavailable"
    And the security system remains in its current state (fail-safe behavior)

  Scenario: Attempt to arm security system without authentication
    Given I am not authenticated
    When I submit a request to arm a security system
    Then I receive a 401 Unauthorized response
    And the security system is not modified
----

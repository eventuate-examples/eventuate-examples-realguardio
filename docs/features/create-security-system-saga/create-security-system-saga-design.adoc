The flow of saga is as follows

[cols="a,a,a,a"]
|===

| Step
| Service
| Transaction
| Compensation

| 1
| Customer Service
| LocationValidated = ValidateLocation(locationId)

Returns locationId, locationName, customerId if location exists.
Returns LocationNotFound if location does not exist.

| — (read-only)

| 2
| Security System Service
| securitySystemId = CreateSecuritySystem(locationId, locationName)

Creates SecuritySystem in DISARMED state with locationId reference.
Returns LocationAlreadyHasSecuritySystem if location already has a security system.

| — (no rollback needed)

|===

== Sending back the HTTP response with the securitySystemId

* The realguardio-orchestration-service sends back a response to the `POST /securitysystems` HTTP request after the saga completes
* The service maintains a ConcurrentHashMap from sagaId to CompletableFuture<> that's the result of the controller method
* The saga has an onReply() handler for the second step that completes the future with the securitySystemId
* NOTE: This works for a single instance. Multiple instances => Per-instance subscriber (to an event or the reply queue) since the instance that handles the reply is not guaranteed to be the same as the one that handles the POST

== Error Handling

* If ValidateLocation returns LocationNotFound, the saga fails and returns 404 to the client
* If CreateSecuritySystem returns LocationAlreadyHasSecuritySystem, the saga fails and returns 409 Conflict to the client


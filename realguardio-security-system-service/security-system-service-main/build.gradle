plugins {
    id 'io.eventuate.plugins.gradle.testing.component-tests'
    id 'io.eventuate.plugins.gradle.testing.integration-tests'
}

componentTest {
    systemProperty "spring.profiles.active", "test,postgres"
}
integrationTest {
    systemProperty "spring.profiles.active", "test,postgres"
}

dependencies {
    implementation project(':security-system-service-domain')
    implementation project(':security-system-service-event-publishing')
    implementation project(':security-system-service-persistence')
    implementation project(':security-system-service-restapi')
    implementation project(':security-system-api-messaging')
    implementation project(':location-roles-replica')
    implementation project(':security-system-service-oso-integration')
    implementation project(':location-roles-replica')
    implementation project(':security-system-service-customer-service-proxy')

    implementation 'org.springframework.boot:spring-boot-starter-web'
    implementation 'org.springframework.boot:spring-boot-starter-oauth2-resource-server'
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    implementation 'org.springframework.boot:spring-boot-starter-actuator'
    implementation 'org.springframework.boot:spring-boot-starter-aop'
    
    runtimeOnly 'org.postgresql:postgresql'
    
    // Micrometer and OpenTelemetry dependencies for distributed tracing
    implementation 'io.micrometer:micrometer-tracing-bridge-otel'
    implementation 'io.opentelemetry:opentelemetry-exporter-otlp'
    implementation 'io.micrometer:micrometer-registry-otlp'
    implementation 'io.opentelemetry.instrumentation:opentelemetry-instrumentation-annotations:2.2.0'
    
    // AspectJ dependencies for custom tracing
    implementation 'org.aspectj:aspectjweaver'
    
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    testImplementation 'org.springframework.boot:spring-boot-starter-webflux'
    testImplementation 'org.testcontainers:postgresql'
    testImplementation 'org.testcontainers:junit-jupiter'
    
    componentTestImplementation project(':security-system-api-messaging')
    componentTestImplementation project(':location-roles-replica')
    componentTestImplementation 'org.springframework.boot:spring-boot-starter-test'
    componentTestImplementation 'io.rest-assured:rest-assured'
    componentTestImplementation 'org.postgresql:postgresql'
    componentTestImplementation 'org.testcontainers:postgresql'
    componentTestImplementation 'org.testcontainers:junit-jupiter'
    componentTestImplementation "io.eventuate.examples.spring-authorization-server:authorization-server-test-containers:$eventuateExamplesSpringAuthorizationServerVersion"
    componentTestImplementation "io.eventuate.messaging.kafka:eventuate-messaging-kafka-testcontainers"
    componentTestImplementation "io.eventuate.common:eventuate-common-testcontainers"
    componentTestImplementation "io.eventuate.tram.core:eventuate-tram-spring-commands"
    componentTestImplementation "io.eventuate.tram.core:eventuate-tram-spring-consumer-kafka"
    componentTestImplementation "io.eventuate.tram.core:eventuate-tram-spring-testing-support-kafka-producer"
    componentTestImplementation "io.eventuate.tram.core:eventuate-tram-spring-testing-support-producer-kafka"
    componentTestImplementation "io.eventuate.tram.core:eventuate-tram-test-util"
    componentTestImplementation "io.eventuate.platform.testcontainer.support:eventuate-platform-testcontainer-support-service:$eventuatePlatformTestContainerSupportVersion"
    componentTestImplementation "org.testcontainers:testcontainers"
    componentTestImplementation "io.eventuate.tram.core:eventuate-tram-spring-testing-support-outbox-commands"
    componentTestImplementation 'io.eventuate.tram.core:eventuate-tram-spring-flyway'
    componentTestImplementation 'io.eventuate.tram.core:eventuate-tram-spring-events-publisher-starter'
    componentTestImplementation "io.eventuate.messaging.kafka:eventuate-messaging-kafka-producer"

    integrationTestImplementation 'org.springframework.boot:spring-boot-starter-test'
    integrationTestImplementation 'org.springframework.boot:spring-boot-starter-webflux'
    integrationTestImplementation 'org.postgresql:postgresql'
    integrationTestImplementation 'org.testcontainers:postgresql'
    integrationTestImplementation 'org.testcontainers:junit-jupiter'
    integrationTestImplementation "io.eventuate.examples.spring-authorization-server:authorization-server-test-containers:$eventuateExamplesSpringAuthorizationServerVersion"
    integrationTestImplementation "io.eventuate.messaging.kafka:eventuate-messaging-kafka-testcontainers"


}
= An Eventuate project

image::https://eventuate.io/i/logo.gif[]

This project is part of http://eventuate.io[Eventuate], which is a microservices collaboration platform.

= RealGuardIO - a fictional commercial real estate security system platform.

This project is a fictional commercial real estate security system platform. 
It's the sample application for a series of articles about authentication and authorization in microservices:

1. https://microservices.io/post/architecture/2025/04/25/microservices-authn-authz-part-1-introduction.html[Overview of authentication and authorization in a microservice architecture]
2. https://microservices.io/post/architecture/2025/05/28/microservices-authn-authz-part-2-authentication.html[Implementing authentication]
3. https://microservices.io/post/architecture/2025/07/22/microservices-authn-authz-part-3-jwt-authorization.html[Implementing JWT-based authorization]
4. https://microservices.io/post/architecture/2025/09/16/microservices-authn-authz-part-4-authorization-using-fetch-and-replicate.html[Implementing authorization using fetch and replicate]
5. https://microservices.io/post/architecture/2025/12/09/microservices-authn-authz-part-5-using-an-authorization-service.html[Implementing complex authorization using Oso Cloud - part 1]
6. Implementing complex authorization using Oso Cloud - part 2

== Application architecture

image::https://microservices.io/i/microservices-auth/part-2/Security-Architecture.png[]

The key elements of the RealGuardIO architecture are as follows:

* React-based UI - runs in the browser and implements the RealGuardIO UI.
* `BFF`  - the NextJS/Typescript-based Backend for front-end, which plays the role of an OAuth 2.0 client. It manages the user's session, forwards requests from the React UI to the backend services and implements security using the `next-auth` library.
* `IAM Service` - handles authentication including the login page and issues access tokens and ID tokens to BFF.
* Backend services:
** `Security System Service` - manages `SecuritySystems` domain entities.
** `Customer Service` - manages `Customers` domain entities.
** `Orchestration Service` - orchestrates the creation of security systems across Customer Service and Security System Service using the Saga pattern to ensure distributed transaction consistency.
** `Oso Integration Service` - integrates Oso Cloud authorization policies with the microservices by consuming domain events from Kafka and updating authorization facts in Oso Cloud.

In addition, there are several supporting services:

* https://www.jaegertracing.io/[`Jaeger`] - distributed tracing for monitoring service interactions.
* `Kafka` - distributed message broker for inter-service communication and event-driven architecture.
* `CDC` - Eventuate Change Data Capture service that captures changes from service databases and publishes events to Kafka.
* `PostgreSQL` - separate databases for Customer Service, Security System Service, and Orchestration Service.

The application uses the https://www.osohq.com/docs[Oso Cloud authorization service] as the centralized authorization service.

== Code tours

Coming soon.

== Running the application

The application uses Docker Compose to run the services.

To run the application, you simply need to install the following prerequisites: Docker.

You can run the application using the following command:

[source, shell]
----
docker compose up -d --build
----

You can stop the application using the following command:

[source, shell]
----
docker compose down
----

== Running the application with Oso Cloud

By default, `docker compose up` uses the Oso Dev server.
However, it also supports using Oso Cloud.

First, set some environment variables:

[source, shell]
----
export OSO_URL=https://api.osohq.com
export OSO_AUTH=<your API key>
----

Note: The https://www.osohq.com/docs/get-started/quickstart[OSO Cloud quickstart guide] describes how to get an API key.

Next, load the policy into the cloud:

[source, shell]
----
oso-cloud policy realguardio-oso-integration-service/policies/main.polar
----

Note: The https://www.osohq.com/docs/develop/local-dev/env-setup#install-the-oso-cloud-cli[OSO documentation] describe how to install the Oso Cloud CLI.

You can also run the policy's built-in tests:

[source, shell]
----
oso-cloud test realguardio-oso-integration-service/policies/main.polar
----

Finally, start the application:

[source, shell]
----
docker compose up -d --build
----

== Using the application

You can access the application at http://localhost:3000.

The credentials are `user1/password`.

== Jaeger distributed tracing

Jaeger is used for distributed tracing in this application. 
It allows you to trace requests as they flow through services.

You can access the https://www.jaegertracing.io/[Jaeger UI] at http://localhost:16686.

Here are the http://localhost:16686/search?service=realguardio-bff&&tags=%7B%22span.kind%22%3A%22client%22%7D[outbound requests from the BFF].

== Developing the application

The application is written in Java, Typescript and React.
To do development, you simply need to install and setup the following prerequisite: https://mise.jdx.dev/getting-started.html[Mise].
Mise will then install Java 17 and Node.js v22.x for you.

== Contributing

Contributions are welcome.

Please sign a https://chrisrichardson.net/legal/[contributor license agreement].
